{% extends 'portal/portal_base.html' %}
{% load static %}

{% block title %}Hồ sơ cá nhân{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="fas fa-user mr-2"></i>Hồ sơ cá nhân</h2>
            <p class="text-muted">Xem và cập nhật thông tin cá nhân của bạn</p>
        </div>
    </div>

    <div class="row">
        <!-- Left Column - Avatar and Quick Info -->
        <div class="col-md-4">
            <div class="card card-primary card-outline">
                <div class="card-body box-profile">
                    <div class="text-center">
                        {% if employee.avatar %}
                            <img class="profile-user-img img-fluid img-circle" 
                                 src="{{ employee.avatar.url }}" 
                                 alt="Avatar"
                                 style="width: 150px; height: 150px; object-fit: cover;">
                        {% else %}
                            <img class="profile-user-img img-fluid img-circle" 
                                 src="{% static 'dist/img/avatar.png' %}" 
                                 alt="Default Avatar"
                                 style="width: 150px; height: 150px; object-fit: cover;">
                        {% endif %}
                    </div>

                    <h3 class="profile-username text-center mt-3">{{ employee.full_name }}</h3>

                    <p class="text-muted text-center">
                        <span class="badge badge-info">{{ employee.position }}</span>
                        {% if employee.is_manager %}
                            <span class="badge badge-warning"><i class="fas fa-star"></i> Manager</span>
                        {% endif %}
                    </p>

                    <ul class="list-group list-group-unbordered mb-3">
                        <li class="list-group-item">
                            <b><i class="fas fa-id-badge mr-2"></i>Mã NV</b>
                            <a class="float-right">{{ employee.employee_code }}</a>
                        </li>
                        <li class="list-group-item">
                            <b><i class="fas fa-building mr-2"></i>Phòng ban</b>
                            <a class="float-right">{{ employee.department.name }}</a>
                        </li>
                        <li class="list-group-item">
                            <b><i class="fas fa-calendar mr-2"></i>Ngày vào</b>
                            <a class="float-right">{{ employee.date_of_joining|date:"d/m/Y" }}</a>
                        </li>
                    </ul>

                    <a href="{% url 'portal_profile_edit' %}" class="btn btn-primary btn-block">
                        <i class="fas fa-edit mr-1"></i> Chỉnh sửa hồ sơ
                    </a>
                    <a href="{% url 'portal_password_change' %}" class="btn btn-warning btn-block">
                        <i class="fas fa-key mr-1"></i> Đổi mật khẩu
                    </a>
                </div>
            </div>

            <!-- Additional Info Card -->
            <div class="card card-primary">
                <div class="card-header">
                    <h3 class="card-title">Thông tin liên hệ</h3>
                </div>
                <div class="card-body">
                    <strong><i class="fas fa-envelope mr-2"></i>Email</strong>
                    <p class="text-muted">{{ employee.email }}</p>
                    <hr>

                    <strong><i class="fas fa-phone mr-2"></i>Điện thoại</strong>
                    <p class="text-muted">{{ employee.mobile }}</p>
                    <hr>

                    <strong><i class="fas fa-map-marker-alt mr-2"></i>Địa chỉ</strong>
                    <p class="text-muted">{{ employee.address }}</p>
                </div>
            </div>
        </div>

        <!-- Right Column - Detailed Info -->
        <div class="col-md-8">
            <!-- Personal Information -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-user-circle mr-2"></i>Thông tin cá nhân</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th width="40%">Họ và tên:</th>
                                    <td>{{ employee.full_name }}</td>
                                </tr>
                                <tr>
                                    <th>Giới tính:</th>
                                    <td>{{ employee.get_gender_display }}</td>
                                </tr>
                                <tr>
                                    <th>Ngày sinh:</th>
                                    <td>{{ employee.birthday|date:"d/m/Y" }}</td>
                                </tr>
                                <tr>
                                    <th>CCCD:</th>
                                    <td>{{ employee.identity_card }}</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th width="40%">Trình độ:</th>
                                    <td>{{ employee.get_education_level_display }}</td>
                                </tr>
                                <tr>
                                    <th>Chuyên ngành:</th>
                                    <td>{{ employee.major|default:"--" }}</td>
                                </tr>
                                <tr>
                                    <th>Trường:</th>
                                    <td>{{ employee.school|default:"--" }}</td>
                                </tr>
                                <tr>
                                    <th>Năm tốt nghiệp:</th>
                                    <td>{{ employee.graduation_year|default:"--" }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Work Information -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-briefcase mr-2"></i>Thông tin công việc</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th width="40%">Mã nhân viên:</th>
                                    <td><strong>{{ employee.employee_code }}</strong></td>
                                </tr>
                                <tr>
                                    <th>Phòng ban:</th>
                                    <td>{{ employee.department.name }}</td>
                                </tr>
                                <tr>
                                    <th>Chức vụ:</th>
                                    <td>{{ employee.position }}</td>
                                </tr>
                                <tr>
                                    <th>Vai trò:</th>
                                    <td>
                                        {% if employee.is_manager %}
                                            <span class="badge badge-warning">Quản lý</span>
                                        {% else %}
                                            <span class="badge badge-info">Nhân viên</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-sm">
                                <tr>
                                    <th width="40%">Ngày vào làm:</th>
                                    <td>{{ employee.date_of_joining|date:"d/m/Y" }}</td>
                                </tr>
                                <tr>
                                    <th>Thời gian làm việc:</th>
                                    <td>{{ work_duration }}</td>
                                </tr>
                                <tr>
                                    <th>Phép năm:</th>
                                    <td><strong class="text-primary">{{ employee.annual_leave_balance }} ngày</strong></td>
                                </tr>
                                <tr>
                                    <th>Trạng thái:</th>
                                    <td>
                                        {% if employee.status == 'active' %}
                                            <span class="badge badge-success">Đang làm việc</span>
                                        {% elif employee.status == 'on_leave' %}
                                            <span class="badge badge-warning">Nghỉ phép</span>
                                        {% elif employee.status == 'resigned' %}
                                            <span class="badge badge-danger">Đã nghỉ việc</span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-chart-bar mr-2"></i>Thống kê năm {{ current_year }}</h3>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border p-3 rounded">
                                <h4 class="text-primary">{{ stats.leaves_taken }}</h4>
                                <small>Ngày nghỉ phép</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border p-3 rounded">
                                <h4 class="text-success">{{ stats.attendance_days }}</h4>
                                <small>Ngày làm việc</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border p-3 rounded">
                                <h4 class="text-warning">{{ stats.late_count }}</h4>
                                <small>Lần đi muộn</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border p-3 rounded">
                                <h4 class="text-info">{{ stats.expenses_count }}</h4>
                                <small>Đơn hoàn tiền</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
