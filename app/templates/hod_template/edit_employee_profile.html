{% extends 'hod_template/base_template.html' %}

{% block page_title %}
Chỉnh Sửa Thông Tin
{% endblock page_title %}

{% block main_content %}
<!-- Content Header -->
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1><i class="fas fa-user-edit"></i> Chỉnh Sửa Thông Tin Cá Nhân</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="{% url 'employee_dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'employee_profile' %}">Hồ sơ</a></li>
                    <li class="breadcrumb-item active">Chỉnh sửa</li>
                </ol>
            </div>
        </div>
    </div>
</section>

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <!-- Profile Image -->
                <div class="card card-primary card-outline">
                    <div class="card-body box-profile">
                        <div class="text-center">
                            {% if employee.avatar %}
                                <img class="profile-user-img img-fluid img-circle" src="{{ employee.avatar.url }}" alt="User profile picture" id="avatar-preview">
                            {% else %}
                                <img class="profile-user-img img-fluid img-circle" src="https://via.placeholder.com/128" alt="User profile picture" id="avatar-preview">
                            {% endif %}
                        </div>
                        <h3 class="profile-username text-center">{{ employee.name }}</h3>
                        <p class="text-muted text-center">{{ employee.job_title.name }}</p>
                    </div>
                </div>

                <!-- Notice Card -->
                <div class="card card-warning">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-exclamation-triangle"></i> Lưu Ý</h3>
                    </div>
                    <div class="card-body">
                        <p class="text-sm">
                            <i class="fas fa-info-circle"></i> Bạn chỉ có thể chỉnh sửa một số thông tin nhất định.
                        </p>
                        <p class="text-sm">
                            <i class="fas fa-lock"></i> Thông tin như tên, email, CCCD không thể tự chỉnh sửa.
                        </p>
                        <p class="text-sm">
                            <i class="fas fa-user-shield"></i> Liên hệ HR nếu cần cập nhật thông tin quan trọng.
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-edit"></i> Cập Nhật Thông Tin</h3>
                    </div>
                    <form method="post" action="{% url 'edit_employee_profile' %}" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="card-body">
                            <!-- Avatar Upload -->
                            <div class="form-group">
                                <label>Ảnh đại diện</label>
                                <div class="input-group">
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="avatar" name="avatar" accept="image/*">
                                        <label class="custom-file-label" for="avatar">Chọn ảnh</label>
                                    </div>
                                </div>
                                <small class="form-text text-muted">
                                    Chấp nhận: JPG, PNG. Tối đa: 5MB
                                </small>
                            </div>

                            <hr>
                            <h5><i class="fas fa-address-book"></i> Thông Tin Liên Hệ</h5>
                            <hr>

                            <!-- Phone -->
                            <div class="form-group">
                                <label>Số điện thoại <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    </div>
                                    <input type="tel" name="phone" class="form-control" value="{{ employee.phone }}" required pattern="[0-9]{10,11}">
                                </div>
                                <small class="form-text text-muted">Số điện thoại 10-11 chữ số</small>
                            </div>

                            <!-- Address -->
                            <div class="form-group">
                                <label>Địa chỉ thường trú <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-home"></i></span>
                                    </div>
                                    <textarea name="address" class="form-control" rows="2" required>{{ employee.address }}</textarea>
                                </div>
                            </div>

                            <!-- Place of Residence -->
                            <div class="form-group">
                                <label>Nơi ở hiện tại <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-building"></i></span>
                                    </div>
                                    <textarea name="place_of_residence" class="form-control" rows="2" required>{{ employee.place_of_residence }}</textarea>
                                </div>
                            </div>

                            <hr>
                            <h5><i class="fas fa-lock"></i> Thông Tin Không Thể Thay Đổi</h5>
                            <hr>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Họ và tên</label>
                                        <input type="text" class="form-control" value="{{ employee.name }}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="text" class="form-control" value="{{ employee.email }}" disabled>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Mã nhân viên</label>
                                        <input type="text" class="form-control" value="{{ employee.employee_code }}" disabled>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>CCCD/CMND</label>
                                        <input type="text" class="form-control" value="{{ employee.identification }}" disabled>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                Các thông tin khác chỉ có thể được cập nhật bởi bộ phận HR. Vui lòng liên hệ HR nếu cần thay đổi.
                            </div>
                        </div>

                        <div class="card-footer">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Lưu Thay Đổi
                            </button>
                            <a href="{% url 'employee_profile' %}" class="btn btn-default">
                                <i class="fas fa-times"></i> Hủy
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
// Preview avatar before upload
document.getElementById('avatar').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('avatar-preview').src = e.target.result;
        };
        reader.readAsDataURL(file);
        
        // Update file label
        document.querySelector('.custom-file-label').textContent = file.name;
    }
});

// Phone validation
document.querySelector('input[name="phone"]').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9]/g, '');
});
</script>
{% endblock main_content %}
