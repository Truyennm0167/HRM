{% extends 'hod_template/base_template.html' %}

{% block page_title %}
Cập nhật nhân viên
{% endblock page_title %}

{% load static %}
{% block main_content %}
<section class="content">
  <div class="container-fluid">
    <form action="{% url 'update_employee_save' %}" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="employee_id" value="{{ employee.id }}">

      <div class="row">
        <!-- LEFT COLUMN -->
        <div class="col-md-6">
          <!-- Thông tin cá nhân -->
          <div class="card card-primary">
            <div class="card-header">
              <h3 class="card-title">Thông tin cá nhân</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label>Mã nhân viên</label>
                <input type="text" class="form-control" name="employee_code" value="{{ employee.employee_code }}" readonly>
              </div>
              <div class="form-group">
                <label>Họ và tên</label>
                <input type="text" class="form-control" name="employee_name" value="{{ employee.name }}">
              </div>
              <div class="form-group">
                <label>Giới tính</label>
                <select class="form-control" name="employee_gender">
                  <option value="0" {% if employee.gender == 0 %}selected{% endif %}>Nam</option>
                  <option value="1" {% if employee.gender == 1 %}selected{% endif %}>Nữ</option>
                  <option value="2" {% if employee.gender == 2 %}selected{% endif %}>Khác</option>
                </select>
              </div>
              <div class="form-group">
                <label>Ngày sinh</label>
                <input type="date" name="employee_birthday" class="form-control" value="{{ employee.birthday|date:'Y-m-d' }}">
              </div>
              <div class="form-group">
                <label>Nơi sinh</label>
                <input type="text" class="form-control" name="employee_place_of_birth" value="{{ employee.place_of_birth }}">
              </div>
              <div class="form-group">
                <label>Nguyên quán</label>
                <input type="text" class="form-control" name="employee_place_of_origin" value="{{ employee.place_of_origin }}">
              </div>
              <div class="form-group">
                <label>Nơi thường trú</label>
                <input type="text" class="form-control" name="employee_place_of_residence" value="{{ employee.place_of_residence }}">
              </div>
              <div class="form-group">
                <label>Căn cước công dân</label>
                <input type="text" class="form-control" name="employee_identification" value="{{ employee.identification }}">
              </div>
              <div class="form-group">
                <label>Ngày cấp</label>
                <input type="date" class="form-control" name="employee_date_of_issue" value="{{ employee.date_of_issue|date:'Y-m-d' }}">
              </div>
              <div class="form-group">
                <label>Nơi cấp</label>
                <input type="text" class="form-control" name="employee_place_of_issue" value="{{ employee.place_of_issue }}">
              </div>
              <div class="form-group">
                <label>Quốc tịch</label>
                <input type="text" class="form-control" name="employee_nationality" value="{{ employee.nationality }}">
              </div>
              <div class="form-group">
                <label>Dân tộc</label>
                <input type="text" class="form-control" name="employee_nation" value="{{ employee.nation }}">
              </div>
              <div class="form-group">
                <label>Tôn giáo</label>
                <input type="text" class="form-control" name="employee_religion" value="{{ employee.religion }}">
              </div>
              <div class="form-group">
                <label>Tình trạng hôn nhân</label>
                <select class="form-control" name="employee_marital_status">
                  <option value="0" {% if employee.marital_status == 0 %}selected{% endif %}>Độc thân</option>
                  <option value="1" {% if employee.marital_status == 1 %}selected{% endif %}>Đã kết hôn</option>
                  <option value="2" {% if employee.marital_status == 2 %}selected{% endif %}>Đã ly hôn</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Ảnh đại diện -->
          <div class="card card-secondary">
            <div class="card-header">
              <h3 class="card-title">Ảnh đại diện</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <div class="custom-file">
                  <input type="file" class="custom-file-input" id="customFile" name="employee_avatar" accept=".jpg,.jpeg,.png">
                  <label class="custom-file-label">Tải lên hình ảnh (jpg, jpeg, png)</label>
                </div>
              </div>
              {% if employee.avatar_url %}
              <div class="mt-3">
                <img id="avatarPreview" src="{{ employee.avatar_url }}" alt="Ảnh đại diện" style="max-width: 200px; border: 1px solid #ddd; padding: 5px;">
              </div>
              {% else %}
              <div class="mt-3">
                <img id="avatarPreview" src="#" alt="Ảnh xem trước" style="max-width: 200px; display: none; border: 1px solid #ddd; padding: 5px;">
              </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col-md-6">
          <!-- Thông tin liên lạc -->
          <div class="card card-warning">
            <div class="card-header">
              <h3 class="card-title">Thông tin liên lạc</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label>Số điện thoại</label>
                <input type="text" class="form-control" name="employee_phone" value="{{ employee.phone }}">
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" class="form-control" name="employee_email" value="{{ employee.email }}">
              </div>
              <div class="form-group">
                <label>Địa chỉ liên lạc</label>
                <input type="text" class="form-control" name="employee_address" value="{{ employee.address }}">
              </div>
            </div>
          </div>

          <!-- Thông tin làm việc -->
          <div class="card card-info">
            <div class="card-header">
              <h3 class="card-title">Thông tin làm việc</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label>Phòng ban</label>
                <select class="form-control" name="employee_department">
                  {% for dept in departments %}
                    <option value="{{ dept.id }}" {% if dept.id == employee.department_id %}selected{% endif %}>{{ dept.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-group">
                <label>Vị trí làm việc</label>
                <input type="text" class="form-control" name="employee_job_position" value="{{ employee.job_position }}">
              </div>
              <div class="form-group">
                <label>Chức vụ</label>
                <select class="form-control" name="employee_job_title">
                  {% for title in job_titles %}
                    <option value="{{ title.id }}" {% if title.id == employee.job_title_id %}selected{% endif %}>{{ title.name }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-group">
                <label>Lương cơ bản</label>
                <input type="text" class="form-control" name="employee_salary" value="{{ employee.salary }}">
              </div>
              <div class="form-group">
                <label>Ngày bắt đầu hợp đồng</label>
                <input type="date" class="form-control" name="employee_contract_start_date" value="{{ employee.contract_start_date|date:'Y-m-d' }}">
              </div>
              <div class="form-group">
                <label>Thời lượng hợp đồng (tháng)</label>
                <input type="text" class="form-control" name="employee_contract_duration" value="{{ employee.contract_duration }}">
              </div>
              <div class="form-group">
                <label>Trạng thái</label>
                <select class="form-control" name="employee_status">
                  <option value="0" {% if employee.status == 0 %}selected{% endif %}>Onboarding</option>
                  <option value="1" {% if employee.status == 1 %}selected{% endif %}>Thử việc</option>
                  <option value="2" {% if employee.status == 2 %}selected{% endif %}>Nhân viên chính thức</option>
                  <option value="3" {% if employee.status == 3 %}selected{% endif %}>Đã nghỉ việc</option>
                  <option value="4" {% if employee.status == 4 %}selected{% endif %}>Bị sa thải</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Học vấn -->
          <div class="card card-success">
            <div class="card-header">
              <h3 class="card-title">Học vấn, Chứng chỉ</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label>Trình độ</label>
                <select class="form-control" name="employee_education_level">
                  <option value="0" {% if employee.education_level == 0 %}selected{% endif %}>Trung cấp</option>
                  <option value="1" {% if employee.education_level == 1 %}selected{% endif %}>Cao đẳng</option>
                  <option value="2" {% if employee.education_level == 2 %}selected{% endif %}>Đại học</option>
                  <option value="3" {% if employee.education_level == 3 %}selected{% endif %}>Thạc sĩ</option>
                  <option value="4" {% if employee.education_level == 4 %}selected{% endif %}>Tiến sĩ</option>
                  <option value="5" {% if employee.education_level == 5 %}selected{% endif %}>Khác</option>
                </select>
              </div>
              <div class="form-group">
                <label>Ngành/Lĩnh vực</label>
                <input type="text" class="form-control" name="employee_major" value="{{ employee.major }}">
              </div>
              <div class="form-group">
                <label>Trường</label>
                <input type="text" class="form-control" name="employee_school" value="{{ employee.school }}">
              </div>
              <div class="form-group">
                <label>Chứng chỉ</label>
                <input type="text" class="form-control" name="employee_certificate" value="{{ employee.certificate }}">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Submit -->
      <div class="card-footer d-flex justify-content-between">
        <button type="submit" class="btn btn-warning w-100 mr-2">Cập nhật</button>
        <a href="{% url 'delete_employee' employee.id %}" class="btn btn-danger w-100">Xóa</a>
      </div>
    </form>
  </div>
</section>
{% endblock main_content %}

{% block custom_js %}
<script>
  document.getElementById("customFile").addEventListener("change", function(event) {
    const [file] = event.target.files;
    if (file) {
      const preview = document.getElementById("avatarPreview");
      preview.src = URL.createObjectURL(file);
      preview.style.display = "block";
    }
  });
</script>
{% endblock custom_js %}
